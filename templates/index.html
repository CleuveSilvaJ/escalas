<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pastoral da Acolhida üïäÔ∏è</title>

    <link rel="icon" href="/static/favicon.png" type="image/png">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">

    <style>
      .btn-semana {
        background-color: #f8f9fa;
        border: 1px solid #198754;
        color: #198754;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        display: inline-block;
        min-width: 90px;
      }
      .btn-semana:hover {
        background-color: #198754;
        color: #fff;
      }
      .btn-semana.active {
        background-color: #198754;
        color: #fff;
        font-weight: bold;
        box-shadow: 0 0 6px rgba(27,94,32,0.6);
      }
    </style>
</head>
<body class="bg-light">

<div class="container mt-4">

    <div class="text-center mb-4">
        <img src="/static/logo.png" alt="Logo da Pastoral da Acolhida" class="logo">
    </div>

    <!-- Mensagens de confirma√ß√£o/aviso -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} fade show" role="alert">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <p class="text-center text-muted mb-2">
        Selecione abaixo qual semana deseja visualizar:
    </p>

    <div class="d-flex flex-wrap justify-content-center mb-3">
        {% for i in range(semanas|length) %}
            <button class="btn btn-semana m-1" onclick="mostrarSemana({{i}})">
                {{ semanas[i].titulo_curto }}
            </button>
        {% endfor %}
    </div>

    {% for i in range(semanas|length) %}
    {% set semana = semanas[i] %}
    <div id="semana{{i}}" class="semana-bloco {% if i != 0 %}d-none{% endif %}">
        <div class="card">
            <div class="card-body">
                <p class="text-center"><strong>{{ saudacao }} üôå</strong></p>
                <p class="text-center">Queridos irm√£os na f√© üôèüïäÔ∏è</p>

                <div class="text-center">
                    <span class="escala-titulo"><strong>Escala da Semana:</strong></span>
                    <span class="escala-datas">{{ semana.titulo }}</span>
                </div>

                {% for dia in semana.dias %}
                <div class="dia-bloco p-3 mb-3">
                    <h4 class="mt-3 text-secondary">
                        <em>{{ dia.nome|upper }} - {{ dia.data }}</em>
                    </h4>
                    <ul class="list-group mb-3">
                        {% for hora in semana.horarios[dia.nome] %}
                            <li class="list-group-item">
                                <span class="horario">{{hora}}:</span>
                                {% set chave = dia.nome + " " + hora %}
                                {% if semana.escala[chave] %}
                                    {{ semana.escala[chave] | join(' / ') }}
                                {% else %}
                                    <span class="text-muted">Sem nomes</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                    {% for extra in semana.informacoes[dia.nome]["extra"] %}
                        <div class="aviso alert-info mt-2 mb-3 p-2">
                            <strong><em>{{ extra }}</em></strong>
                        </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="row g-3 mt-3">
            <!-- Adicionar -->
            <div class="col-12 col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-success text-white"><strong>ADICIONAR NOME</strong></div>
                    <div class="card-body">
                        <form action="/adicionar/{{i}}" method="post" class="row g-3">
                            <div class="col-12 col-md-4">
                                <input type="text" name="nome" class="form-control" placeholder="Digite seu nome">
                            </div>
                            <div class="col-12 col-md-4">
                                <select id="diaAdicionar{{i}}" name="dia" class="form-select" onchange="atualizarHorarios({{i}}, 'Adicionar')">
                                    {% for dia in semana.dias %}
                                        <option value="{{dia.nome}}">{{dia.nome}} - {{dia.data}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12 col-md-4">
                                <select id="horaAdicionar{{i}}" name="hora" class="form-select"></select>
                            </div>
                            <div class="col-12 d-flex align-items-center">
                                <button type="submit" class="btn btn-success me-2">Adicionar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Remover -->
            <div class="col-12 col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-danger text-white"><strong>REMOVER NOME</strong></div>
                    <div class="card-body">
                        <form action="/remover/{{i}}" method="post" class="row g-3">
                            <div class="col-12 col-md-4">
                                <input type="text" name="nome" class="form-control" placeholder="Digite o nome">
                            </div>
                            <div class="col-12 col-md-4">
                                <select id="diaRemover{{i}}" name="dia" class="form-select" onchange="atualizarHorarios({{i}}, 'Remover')">
                                    {% for dia in semana.dias %}
                                        <option value="{{dia.nome}}">{{dia.nome}} - {{dia.data}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12 col-md-4">
                                <select id="horaRemover{{i}}" name="hora" class="form-select"></select>
                            </div>
                            <div class="col-12 d-flex align-items-center">
                                <button type="submit" class="btn btn-danger me-2">Remover</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

    <div class="text-center mt-4">
        <a href="/admin" class="btn btn-outline-secondary btn-lg px-4">
            √Årea do Coordenador
        </a>
    </div>

    <footer class="text-center mt-5 mb-3 text-muted small">
        ¬© 2026 - Sistema desenvolvido por Cleuve Jesus ‚úùÔ∏è
    </footer>
</div>

<!-- Scripts -->
<script>
function mostrarSemana(index) {
  document.querySelectorAll(".semana-bloco").forEach((el, i) => {
    el.classList.toggle("d-none", i !== index);
  });
  document.querySelectorAll(".btn-semana").forEach((btn, i) => {
    btn.classList.toggle("active", i === index);
  });
  localStorage.setItem("semanaAtiva", index);
}

const semanasData = {{ semanas | tojson }};

function atualizarHorarios(semanaIndex, tipo) {
  const diaSelect = document.getElementById(`dia${tipo}${semanaIndex}`);
  const horaSelect = document.getElementById(`hora${tipo}${semanaIndex}`);
  const diaEscolhido = diaSelect.value;

  horaSelect.innerHTML = "";

  const horariosPorDia = semanasData[semanaIndex].horarios;
  if (horariosPorDia[diaEscolhido]) {
    horariosPorDia[diaEscolhido].forEach(hora => {
      const opt = document.createElement("option");
      opt.value = hora;
      opt.textContent = hora;
      horaSelect.appendChild(opt);
    });
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const semanaAtiva = localStorage.getItem("semanaAtiva") || 0;
  mostrarSemana(parseInt(semanaAtiva));

  {% for i in range(semanas|length) %}
    atualizarHorarios({{i}}, 'Adicionar');
    atualizarHorarios({{i}}, 'Remover');
  {% endfor %}
});

/* ‚úÖ AUTO-HIDE DOS AVISOS */
setTimeout(() => {
  document.querySelectorAll('.alert').forEach(el => el.remove());
}, 4000);
</script>
<script>
setTimeout(() => {
  document.querySelectorAll('.alert.flash').forEach(alert => {
    alert.style.transition = "opacity 0.8s ease";
    alert.style.opacity = "0";

    setTimeout(() => {
      alert.remove();
    }, 800);
  });
}, 3500);
</script>



</body>
</html>
